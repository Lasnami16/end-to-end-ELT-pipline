#STEP 1: Authenticate Docker with Artifact Registry
gcloud auth configure-docker europe-west9-docker.pkg.dev
#STEP 2: Build the Docker Image Locally
docker build -t europe-west9-docker.pkg.dev/wissem-school/end-to-end-etl-pipline/mongodb-to-gcs-job .
STEP 3: Push the Docker Image to Artifact Registry
docker push europe-west9-docker.pkg.dev/wissem-school/end-to-end-etl-pipline/mongodb-to-gcs-job
# STEP 4: Deploy as a Cloud Run Job
gcloud run jobs create mongodb-to-gcs-job \
  --image europe-west9-docker.pkg.dev/wissem-school/end-to-end-etl-pipline/mongodb-to-gcs-job \
  --region europe-west9 \
  --set-env-vars MONGODB_CONNECTION="mongodb+srv://lasnamiabdelkarim:O9ztKaKpOGxZna9w@translation.d7i1rqk.mongodb.net/?retryWrites=true&w=majority&appName=translation",GCS_BUCKET_NAME="traduction_rapidos",GOOGLE_APPLICATION_CREDENTIALS="/app/credentials.json" \
  --memory 512Mi \
  --service-account google-drive@wissem-school.iam.gserviceaccount.com

#create first time the cloud run
gcloud run jobs create mongodb-to-gcs-job --image europe-west9-docker.pkg.dev/wissem-school/end-to-end-etl-pipline/mongodb-to-gcs-job --region europe-west9 --set-env-vars MONGODB_CONNECTION="mongodb+srv://lasnamiabdelkarim:O9ztKaKpOGxZna9w@translation.d7i1rqk.mongodb.net/?retryWrites=true&w=majority&appName=translation",GCS_BUCKET_NAME="traduction_rapidos",GOOGLE_APPLICATION_CREDENTIALS="/app/credentials.json",GCS_FOLDER="translations" --memory 512Mi --service-account google-drive@wissem-school.iam.gserviceaccount.com


gcloud run jobs create mongodb-to-gcs-job --image europe-west9-docker.pkg.dev/wissem-school/end-to-end-etl-pipline/mongodb-to-gcs-job --region europe-west9 --set-env-vars MONGODB_CONNECTION="mongodb+srv://cwfswgs:O9ztKaKpOGxZna9w@wfsvff.d7i1rqk.mongodb.net/?retryWrites=true&w=majority&appName=translation",GCS_BUCKET_NAME="traduction_rapidos",GOOGLE_APPLICATION_CREDENTIALS="/app/credentials.json",GCS_FOLDER="translations" --memory 512Mi --service-account wwc-drive@wfr-wrw.iam.gserviceaccount.com


gcloud run jobs update mongodb-to-gcs-job `
  --image europe-west9-docker.pkg.dev/wissem-school/end-to-end-etl-pipline/mongodb-to-gcs-job `
  --region europe-west9 `
  --set-env-vars "MONGODB_CONNECTION='mongodb+srv://lasnamiabdelkarim:O9ztKaKpOGxZna9w@translation.d7i1rqk.mongodb.net/?retryWrites=true&w=majority&appName=translation',GCS_BUCKET_NAME='traduction_rapidos',GOOGLE_APPLICATION_CREDENTIALS='/app/credentials.json',GCS_FOLDER='translations',TEST='test'" `
  --memory 512Mi `
  --service-account google-drive@wissem-school.iam.gserviceaccount.com


#ALL in One
gcloud auth configure-docker europe-west9-docker.pkg.dev
docker build -t europe-west9-docker.pkg.dev/wissem-school/end-to-end-etl-pipline/mongodb-to-gcs-job .
docker push europe-west9-docker.pkg.dev/wissem-school/end-to-end-etl-pipline/mongodb-to-gcs-job
gcloud run jobs update mongodb-to-gcs-job `
  --image europe-west9-docker.pkg.dev/wissem-school/end-to-end-etl-pipline/mongodb-to-gcs-job `
  --region europe-west9 `
  --set-env-vars "MONGODB_CONNECTION='mongodb+srv://lasnamiabdelkarim:O9ztKaKpOGxZna9w@translation.d7i1rqk.mongodb.net/?retryWrites=true&w=majority&appName=translation',GCS_BUCKET_NAME='traduction_rapidos',GOOGLE_APPLICATION_CREDENTIALS='/app/credentials.json',GCS_FOLDER='translations',TEST='test'" `
  --memory 512Mi `
  --service-account google-drive@wissem-school.iam.gserviceaccount.com